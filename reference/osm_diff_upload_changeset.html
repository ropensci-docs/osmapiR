<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Diff (OsmChange format) upload to a changeset — osm_diff_upload_changeset • osmapiR</title><!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Diff (OsmChange format) upload to a changeset — osm_diff_upload_changeset"><meta name="description" content="With this API call files in the OsmChange format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none."><meta property="og:description" content="With this API call files in the OsmChange format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none."><meta property="og:image" content="https://docs.ropensci.org/osmapiR/logo.svg"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css"><script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">osmapiR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="../articles/osmapiR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/how_to_edit_gps_traces.html">How to edit GPS traces</a></li>
    <li><a class="dropdown-item" href="../articles/how_to_edit_osm.html">How to edit OpenStreetMap</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/osmapiR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Diff (OsmChange format) upload to a changeset</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmapiR/blob/master/R/osmapi_changesets.R" class="external-link"><code>R/osmapi_changesets.R</code></a></small>
      <div class="d-none name"><code>osm_diff_upload_changeset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>With this API call files in the <a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a> format can be uploaded to
the server. This is guaranteed to be running in a transaction. So either all the changes are applied or none.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">osm_diff_upload_changeset</span><span class="op">(</span><span class="va">changeset_id</span>, <span class="va">osmcha</span>, format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"R"</span>, <span class="st">"xml"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-changeset-id">changeset_id<a class="anchor" aria-label="anchor" href="#arg-changeset-id"></a></dt>
<dd><p>The ID of the changeset this diff belongs to. The user issuing this API call has to be the same
that created the changeset.</p></dd>


<dt id="arg-osmcha">osmcha<a class="anchor" aria-label="anchor" href="#arg-osmcha"></a></dt>
<dd><p>The OsmChange data. Can be the path of an OsmChange file, a xml2::xml_document or an
<code>osmapi_OsmChange</code> object (see <code>osmchange_*()</code> functions).</p></dd>


<dt id="arg-format">format<a class="anchor" aria-label="anchor" href="#arg-format"></a></dt>
<dd><p>Format of the output. Can be <code>"R"</code> (default) or <code>"xml"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If a diff is successfully applied and <code>format = "R"</code>, it returns a data frame with one row for each edited object.
For <code>format = "xml"</code>, a xml2::xml_document is returned in the following format:</p>
<p></p><div class="sourceCode xml"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>&lt;<span class="kw">diffResult</span><span class="ot"> generator=</span><span class="st">"OpenStreetMap Server"</span><span class="ot"> version=</span><span class="st">"0.6"</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    &lt;<span class="kw">node</span><span class="er">|</span><span class="ot">way</span><span class="er">|relation</span> <span class="er">old_id</span><span class="ot">=</span><span class="st">"#"</span><span class="ot"> new_id=</span><span class="st">"#"</span><span class="ot"> new_version=</span><span class="st">"#"</span>/&gt;</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    ...</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>&lt;/<span class="kw">diffResult</span>&gt;</span></code></pre><p></p></div>
<p>with one element for every object in the upload.</p>
<p>Note that this can be counter-intuitive when the same element has appeared multiple times in the input then it will
appear multiple times in the output.</p><table class="table table"><tr><td><strong>Attribute</strong></td><td><strong>create</strong></td><td><strong>modify</strong></td><td><strong>delete</strong></td></tr><tr><td><strong>old_id</strong></td><td>same as uploaded element</td><td>same as uploaded element</td><td>same as uploaded element</td></tr><tr><td><strong>new_id</strong></td><td>new ID</td><td>new ID ”or” same as uploaded</td><td>not present</td></tr><tr><td><strong>new_version</strong></td><td>new version</td><td>new version</td><td>not present</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To upload an OSC file it has to conform to the <a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a>
specification with the following differences:</p><ul><li><p>each element must carry a <code>changeset</code> and a <code>version</code> attribute (xml) / column (data.frame), except when you are
creating an element where the version is not required as the server sets that for you. The <code>changeset</code> must be the
same as the changeset ID being uploaded to.</p></li>
<li><p>a <code>&lt;delete&gt;</code> block in the OsmChange document may have an <code>if-unused</code> attribute (the value of which is ignored)
(<code>action_type</code> column with <code>delete if-unused</code> for data.frames). If this attribute is present, then the delete
operation(s) in this block are conditional and will only be executed if the object to be deleted is not used by
another object. Without the <code>if-unused</code>, such a situation would lead to an error, and the whole diff upload would
fail. Setting the attribute will also cause deletions of already deleted objects to not generate an error.</p></li>
<li><p><a href="https://wiki.openstreetmap.org/wiki/OsmChange" class="external-link">OsmChange</a> documents generally have <code>user</code> and <code>uid</code> attributes
on each element. These are not required in the document uploaded to the API.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>

<ul><li><p>Processing stops at the first error, so if there are multiple conflicts in one diff upload, only the first problem
is reported.</p></li>
<li><p>Refer to <code><a href="osm_capabilities.html">osm_capabilities()</a></code> –&gt; <code>changesets$maximum_elements</code> for the maximum number of changes permitted in a
changeset.</p></li>
<li><p>There is currently no limit in the diff size on the Rails port. CGImap limits diff size to 50MB (uncompressed
size).</p></li>
<li><p>Forward referencing of placeholder ids is not permitted and will be rejected by the API.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other edit changeset's functions:
<code><a href="osm_create_changeset.html">osm_create_changeset</a>()</code></p>
<p>Other OsmChange's functions:
<code><a href="osm_download_changeset.html">osm_download_changeset</a>()</code>,
<code><a href="osmchange_create.html">osmchange_create</a>()</code>,
<code><a href="osmchange_delete.html">osmchange_delete</a>()</code>,
<code><a href="osmchange_modify.html">osmchange_modify</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"how_to_edit_osm"</span>, package <span class="op">=</span> <span class="st">"osmapiR"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>vignette ‘how_to_edit_osm’ not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>





  </body></html>

